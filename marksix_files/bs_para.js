var pmap = new Array();
pmap['IsDefaultPara'] = 'IsDefaultPara';
pmap['eWinASDetection'] = 'eWinASDetection';
pmap['eWinGWDetection'] = 'eWinGWDetection';
pmap['eWinLSDetection'] = 'eWinLSDetection';
pmap['eWinMDDetection'] = 'eWinMDDetection';
pmap['CAPDetection'] = 'CAPDetection';
pmap['IsDefaultPara'] = 'IsDefaultPara';
pmap['InPlayDelay'] = 'InPlayDelaySec';
pmap['CrossTourn'] = 'CrossTourn';
pmap['OnlineRefreshInterval'] = 'OnlineParaRefreshInterval';
pmap['SessionIdleTime'] = 'SessionIdleTime';        // 1-5
pmap['WIN'] = 'winp';
pmap['PLA'] = 'plap';
pmap['W-P'] = 'wpp';
pmap['QIN'] = 'qinp';
pmap['QPL'] = 'qplp';			// 6-10
pmap['QQP'] = 'qqpp';
pmap['TRI'] = 'trip';
pmap['DBL'] = 'dblp';
pmap['TCE'] = 'tcep';
pmap['D-T'] = 'dtp';				// 11-15
pmap['T-T'] = 'ttp';
pmap['TBL'] = 'tblp';
pmap['6UP'] = 'sixupp';
pmap['MK6'] = 'mk6p';
pmap['MATCH-3'] = 'mt3p';			// 16-20
pmap['EXN'] = 'exnp';
pmap['MHG'] = 'mhgp';
pmap['EOC'] = 'eocp';
pmap['OUG'] = 'ougp';
pmap['MinDeposit'] = 'TBMinDeposit';		// 21-25
pmap['MaxDeposit'] = 'TBMaxDeposit';
pmap['MinWithdrawal'] = 'TBMinWithdrawal';
pmap['MaxWithdrawal'] = 'TBMaxWithdrawal';
pmap['MinWithdrawalAuto'] = 'TBMinAutoWithdrawal';
pmap['MaxWithdrawalAuto'] = 'TBMaxAutoWithdrawal';	// 26-30
pmap['MaxBetUnit'] = 'MaxBetUnit';
pmap['MaxMarkSixNo'] = 'CurrentMK6Max';
pmap['BetReplyTimeout'] = 'BetReplyTimeout';
pmap['EFTReplyTimeout'] = 'EFTReplyTimeout';
pmap['WarningTimeout'] = 'WarningTimeout';	// 31-35
pmap['QPTT'] = 'QPTTGame';
pmap['Goldball'] = 'GoldballGame';
pmap['MaxPrimaryNo'] = 'MaxPrimaryNo';
pmap['MinGBNo'] = 'MinGBNo';
pmap['MaxGBNo'] = 'MaxGBNo';			// 36-40
pmap['GBMATCH-3'] = 'GBmt3p';
pmap['GBEXN'] = 'GBexnp';
pmap['GBMHG'] = 'GBmhgp';
pmap['GBEOC'] = 'GBeocp';
pmap['GBOUG'] = 'GBougp';				// 41-45
pmap['eWinRegistration'] = 'AllowRegistration';
pmap['ShutDownTime'] = 'ShutDownTime';
pmap['MinutesAheadForAlert'] = 'MinutesAheadForAlert';
pmap['WelcomeMessage'] = 'ShowHBWelcomeMessage';
pmap['OnlineStatTimeFrame'] = 'OnlineStatTimeFrame'; // 46-50
pmap['OnlineStmtRecPerPage'] = 'OnlineStmtRecPerPage';
pmap['HorseRaceCrossPool'] = 'XRace';
pmap['CrossPoolWIN'] = 'XWINp';
pmap['CrossPoolPLA'] = 'XPLAp';
pmap['CrossPoolQIN'] = 'XQINp';		// 51-55
pmap['CrossPoolQPL'] = 'XQPLp';
pmap['CrossPoolTRI'] = 'XTRIp';
pmap['CrossPoolW-P'] = 'AXWinPla';
pmap['CrossPoolQQP'] = 'AXQinQpl';
pmap['Snowball'] = 'MK6SBDraw';		// 56-60
pmap['F-F'] = 'ffp';
pmap['BWA'] = 'B_Wp';
pmap['CrossPoolBW'] = 'XB_Wp';
pmap['BWB'] = 'BWBp';
pmap['BWC'] = 'BWCp';				// 61-65
pmap['BWD'] = 'BWDp';
pmap['InterCrossBW'] = 'InterXBWp';
pmap['MK6MultiDraw'] = 'MK6MultipleDraw';
pmap['TTQP'] = 'QPTTGame20';
pmap['OldEwinLoadingTime'] = 'MainPageLoadingTime';		// 66-70
pmap['FixedOdds'] = 'FORp';
pmap['JKC'] = 'JKCp';
pmap['FlexiHR'] = 'FlexiBet';
pmap['FlexiWIN'] = 'FlexiBet_winp';
pmap['FlexiPLA'] = 'FlexiBet_plap'; 		// 71-75
pmap['FlexiW-P'] = 'FlexiBet_wpp';
pmap['FlexiQIN'] = 'FlexiBet_qinp';
pmap['FlexiQPL'] = 'FlexiBet_qplp';
pmap['FlexiQQP'] = 'FlexiBet_qqpp';
pmap['FlexiTRI'] = 'FlexiBet_trip'; 		// 76-80
pmap['FlexiDBL'] = 'FlexiBet_dblp';
pmap['FlexiTCE'] = 'FlexiBet_tcep';
pmap['FlexiD-T'] = 'FlexiBet_dtp';
pmap['FlexiT-T'] = 'FlexiBet_ttp';
pmap['FlexiTBL'] = 'FlexiBet_tblp'; 		// 81-85
pmap['Flexi6UP'] = 'FlexiBet_sixupp';
pmap['FlexiTTQP'] = 'FlexiBet_qpttp';
pmap['FlexiF-F'] = 'FlexiBet_ffp';
pmap['FlexiALUP'] = 'FlexiBet_alupp';
pmap['PLAoddsAsRange'] = 'PLAoddsAsRange';  // 86-90
pmap['Mk6TotalBetSpend'] = 'Mk6TotalBetSpend';
pmap['Mk6ByProdMulti'] = 'Mk6ByProdMulti';
pmap['Mk6ByProdBanker'] = 'Mk6ByProdBanker';
pmap['Mk6DefaultUnitBetAmount'] = 'Mk6DefaultUnitBetAmount';
pmap['Mk6PartialUnitBetAmount'] = 'Mk6PartialUnitBetAmount';  // 91-95
pmap['TransferLowerRange'] = 'TransferLowerRange';
pmap['TransferUpperRange'] = 'TransferUpperRange';
pmap['IsEnablePPSG'] = 'IsEnablePPSG';
pmap['PPSTimeout'] = 'PPSTimeout';
pmap['PPSCharge'] = 'Charge';               // 96-100
pmap['ShowChiHandwriting'] = 'ChHWp';
pmap['OnlineStatTimeFrame4SpeedBet'] = 'OnlineStatTimeFrame4SpeedBet';
pmap['DDATransferLowerRange'] = 'DDATransferLowerRange';
pmap['DDATransferUpperRange'] = 'DDATransferUpperRange';
pmap['IsEnabledDDA'] = 'IsEnabledDDA';      // 101-105
pmap['IsEnabledELVA'] = 'ELVA';
pmap['QTT'] = 'qttp';
pmap['FlexiQTT'] = 'FlexiBet_qttp';
pmap['CW'] = 'cwp';
pmap['CrossPoolCW'] = 'XCWp';           // 106-110
pmap['FlexiCW'] = 'FlexiBet_cwp';
pmap['CWA'] = 'cwp';
pmap['CrossPoolCWA'] = 'XCWp';           
pmap['FlexiCWA'] = 'FlexiBet_cwp';
pmap['CWB'] = 'cwp';                     // 111-115
pmap['CrossPoolCWB'] = 'XCWp';
pmap['FlexiCWB'] = 'FlexiBet_cwp';
pmap['CWC'] = 'cwp';
pmap['CrossPoolCWC'] = 'XCWp';
pmap['FlexiCWC'] = 'FlexiBet_cwp';      // 116-120
pmap['IWN'] = 'iwnp';
pmap['FlexiIWN'] = 'FlexiBet_iwnp';
pmap['FCT'] = 'fctp';
pmap['FlexiFCT'] = 'FlexiBet_fctp';
pmap['CrossPoolFCT'] = 'Xfctp';
pmap['TNC'] = 'tncp';					// 121-125

var pmapS = new Array();
pmapS['Football'] = 'SBp';
pmapS['HAD'] = 'HADp';
pmapS['AlupHAD'] = 'AHADp';
pmapS['HDC'] = 'HDCp';
pmapS['TTG'] = 'TTGp';
pmapS['CRS'] = 'CRSp';							// 1-5
pmapS['CRSP'] = 'CRSPp';
pmapS['HFTP'] = 'HFTPp';
pmapS['HFT'] = 'HFTp';
pmapS['OOE'] = 'OOEp';
pmapS['HIL'] = 'HILp';							// 6-10
pmapS['FGS'] = 'FGSp';
pmapS['HCSP'] = 'HCSPp';
pmapS['THFP'] = 'THFPp';
pmapS['HHA'] = 'HHAp';
pmapS['AlupHHA'] = 'AHHAp';					// 11-15
pmapS['AlupCRS'] = 'ACRSp';
pmapS['HFMP6'] = 'HFMP6p';
pmapS['AlupOOE'] = 'AOOEp';
pmapS['AlupHIL'] = 'AHILp';
pmapS['AlupTTG'] = 'ATTGp';						// 16-20
pmapS['AlupHFT'] = 'AHAFUp';
pmapS['DHCP'] = 'DHCPp';
pmapS['CHP'] = 'CHPp';
pmapS['TOFP'] = 'CHPPp';
pmapS['ADTP'] = 'FINPp';						// 21-25
pmapS['GPF'] = 'GPFp';
pmapS['AlupGPF'] = 'AGPFp';
pmapS['SPC'] = 'SPCp';
pmapS['TPS'] = 'TPSp';
pmapS['GPW'] = 'GPWp';							// 26-30
pmapS['HFMP8'] = 'HFMP8p';
pmapS['AlupGPW'] = 'AGPWp';
pmapS['AlupHDC'] = 'AHDCp';
pmapS['STB'] = 'STB';
pmapS['CrossPoolBet'] = 'XFB';					// 31-35
pmapS['CrossPoolHAD'] = 'XHADp';
pmapS['CrossPoolHHA'] = 'XHHADp';
pmapS['CrossPoolHDC'] = 'XHDCp';
pmapS['InPlayBetting'] = 'InPlay';
pmapS['InPlaySpecial'] = 'InPlaySpecial';		// 36-40
pmapS['AlupFGS'] = 'AFGSp';
pmapS['FHA'] = 'FHADp';
pmapS['AlupFHA'] = 'AFHADp';
pmapS['CrossPoolFHA'] = 'AXFHADp';
pmapS['CrossPoolHIL'] = 'AXHILp';				// 41-45
pmapS['FBRegistration'] = 'SBRegisterIdx';
pmapS['FBWelcomeMessage'] = 'ShowSBWelcomeMessage';
pmapS['TQL'] = 'ToQualify';
pmapS['ETS'] = 'ExtraTime';
pmapS['NTS'] = 'NTSp';							// 46-50
pmapS['CrossPoolTTG'] = 'AXTTGp';
pmapS['CrossPoolHFT'] = 'AXHFTp';
pmapS['CrossPoolOOE'] = 'AXOOEp';
pmapS['CrossPoolCRS'] = 'AXCRSp';
pmapS['CrossPoolFGS'] = 'AXFGSp';
pmapS['FTS'] = 'FTSp';
pmapS['AlupFTS'] = 'AFTSp';
pmapS['CrossPoolFTS'] = 'AXFTSp';
pmapS['FHL'] = 'FHILp';
pmapS['AlupFHL'] = 'AFHILp';
pmapS['CrossPoolFHL'] = 'AXFHILp';
pmapS['FCS'] = 'FCRSp';
pmapS['AlupFCS'] = 'AFCRSp';
pmapS['CrossPoolFCS'] = 'AXFCRSp';
pmapS['AlupNTS'] = 'ANTSp';
pmapS['CrossPoolNTS'] = 'AXNTSp';
pmapS['CHL'] = 'CHLp';
pmapS['AlupCHL'] = 'ACHLp';
pmapS['CrossPoolCHL'] = 'AXCHLp';
pmapS['MSP'] = 'SPCp';
pmapS['TSP'] = 'SPCp';
pmapS['SGA'] = 'SGAp';


var pmapO = new Array();
pmapO['OosMsgId'] = 'OosMsgId';
pmapO['OosMsgEn'] = 'OosMsgEn';
pmapO['OosMsgCh'] = 'OosMsgCh';
pmapO['XSellOption'] = 'XSellOption';
pmapO['XSellTimeout'] = 'XSellTimeout';
pmapO['PPSEOD'] = 'PPSEOD';
pmapO['PPSEODB4Min'] = 'PPSEODB4Min';
pmapO['EnterPassword'] = 'EnterPassword';
				
var int_cross_tourn_para				= 0;
var int_in_play_delay_time				= 0;

var channelArray = new Array();

function loadEwinPara(url) {
	$.ajax({
		type:"POST",
		url: url,
		processData: true,
		success: function(msg){loadEwinParaSuccess(msg["GetEwinParasResult"])},
		error: function(msg){console.log(msg)}
	});
}

function loadEwinParaSuccess(msg) {
	var arr = [];
	if (msg) {
		for (var i = 0; i < msg.length; i++) {
			arr[msg[i].Key] = msg[i].Value;
		}
	}
	
	loadPara(arr.channelPara);
	loadOnlinePara(arr.onlinePara);
	
	showOOSMsg();
	initPSObj();
	setMinBet(minBet);

	// init M6 para again
	try {
		initM6PUB();
	} catch (e) {}

	// init RS flexibet cal
	try {
		initRSCal();
	} catch (e) {}

    // force update RS OddsTable
	try {
		refreshWPTable();
	} catch (e) {}
	
	// clean up all session storage first
    ClearDataStore();
    sendCheckSSOSignInStatusRequest(initBetslip, initBetslip);
	SetAllupformula(alupMaxLeg);
	var panels = $('div.slipMultiPanel');
	multiSlipPanel = new MultiSlipPanel(panels);
}

function loadPara(paraStr) {
  var channelParas = paraStr.split('|||');
  for (var i = 1; i < channelParas.length; i++) {
    var nameValuePair = channelParas[i].split('###');
    channelArray[nameValuePair[0]] = nameValuePair[1];
  }

  int_in_play_delay_time = channelArray[pmap['InPlayDelay']];
  int_cross_tourn_para = channelArray[pmap['CrossTourn']];
  loadEftParameter();
}

function loadOnlinePara(paraOnline) {
  var ary = paraOnline.split('|||');
  channelArray[pmapO['OosMsgId']] = ary[0];
  channelArray[pmapO['OosMsgEn']] = ary[1];
  channelArray[pmapO['OosMsgCh']] = ary[2];
  channelArray[pmapO['XSellOption']] = ary[3];
  channelArray[pmapO['XSellTimeout']] = ary[4];
  channelArray[pmapO['PPSEOD']] = ary[5];
  channelArray[pmapO['PPSEODB4Min']] = ary[6];
  channelArray[pmapO['EnterPassword']] = ary[7];
}

function IsBetTypeEnabled(betType) { //keep
	if (betType == undefined || betType == null || betType == '')
		return false;

	betType = TranslateBetType(betType);

	if ((pmap[betType] != null && channelArray[pmap[betType]] == 1)
		|| (pmapS[betType] != null && channelArray[pmapS[betType]] == 1)
		|| betType.indexOf('ALUP') == 0) {
		return true;
	}
	return false;
}

function TranslateBetType(betType) {
	var tp = betType;
	switch (betType) {
		case "EHA":
			tp = "HAD";
			break;
		case "EDC":
			tp = "HDC";
			break;
		case "EHL":
			tp = "HIL";
			break;
		case "ECH":
			tp = "CHL";
			break;
		case "ECS":
			tp = "CRS";
			break;
		case "ENT":
			tp = "NTS";
			break;
		case "ETG":
			tp = "TTG";
			break;
	}

	return tp;
}

function IsAllUpEnabled(foBetObj) { //keep
  if (foBetObj.bType.indexOf('ALUP')>=0 && foBetObj.prod=='FB' && GetFBPara('CrossPoolBet')!='1')
    return false;
  else if (foBetObj.bType.indexOf('ALUP')>=0 && foBetObj.prod=='HR' && GetPara('HorseRaceCrossPool')!='1')
    return false;
  return true;
}

function IsAllUpBetlineEnabled(foBetObj) {
  var isSingleAlup = true;
  var firstBetType = foBetObj.pools[0].bType;
  firstBetType = TranslateBetType(firstBetType);
	
  for (var i = 1; i < foBetObj.pools.length; i++) {
   	if (firstBetType != foBetObj.pools[i].bType && !(isCwinPool(firstBetType) && isCwinPool(foBetObj.pools[i].bType))
		|| (isCwinPool(firstBetType) && isCwinPool(foBetObj.pools[i].bType))) {
        isSingleAlup = false;
      if ( foBetObj.prod == 'HR' && (!GetXPoolAllUpEnabled(firstBetType) || !GetXPoolAllUpEnabled(foBetObj.pools[i].bType)) )
        return false;
      else if (foBetObj.prod == 'FB' && ((IsValidFBBetType(firstBetType) && !GetXPoolAllUpEnabled(firstBetType))
        || (IsValidFBBetType(foBetObj.pools[i].bType) && !GetXPoolAllUpEnabled(foBetObj.pools[i].bType))))
        return false;
    }
  }
  if (isSingleAlup && foBetObj.prod == 'FB' && IsValidFBBetType(firstBetType) && GetFBPara('Alup' + firstBetType) != '1')
    return false;
  return true;
}

function IsValidFBBetType(betType) {
  for (var i = 0; i < array_str_fb_fixed_odds_type.length; i++) {
    if (array_str_fb_fixed_odds_type[i] == betType)
      return true;
  }
  return false;
}

function IsExtraTimeBetEnabled(isExtraTime) {  //keep
  if ( isExtraTime=='1' ) {
    if (channelArray[pmapS['ETS']] == 1)
      return true;
    else
      return false;
  }
  return true;
}

function GetPara(paraName) {
	return channelArray[pmap[paraName]];
}

function GetFlexiPara(paraName) {
	return channelArray[pmap['Flexi' + paraName]]==1;
}

function GetFBPara(paraName) {
	paraName = TranslateBetType(paraName);
	return channelArray[pmapS[paraName]];
}

function GetOnlinePara(paraName) {
  return channelArray[pmapO[paraName]];
}

function MyParseInt(strValue, defaultValue) {
	if (isNaN(strValue)) {
		return defaultValue;
	}
	return parseInt(strValue, 10);
}

function isValidTTQP(betInfo, betLine, isRandGen) {
  if ( betInfo.type == 'T-T' ) {
    if ( betLine.indexOf('|') < 0 && isRandGen == 1
      && channelArray[pmap['TTQP']] == 1 && betInfo.numOfSelection==1 )
      return false;		// Single T-T & RG and TTQP is on
    else if ( betLine.indexOf('|') > 0 && isRandGen == 0 && channelArray[pmap['TTQP']] == 1 )
    	return false;		// Double T-T & no RG and TTQP is on
    else if ( betLine.indexOf('|') > 0 && channelArray[pmap['TTQP']] == 0 )
    	return false;    // Double T-T and TTQP is off
  }
  return true;
}

function isCwinPool(type) {
	if ($.inArray(type, ["CWA", "CWB", "CWC"]) >= 0) {
		return true;
	}
	return false;
}

function setDisclaimerText() {
	$.getJSON(tAndCPath, function(data) {
		var dText = (GetLanguage()==cLangENG) ? data["tAndcEn"] : data["tAndcCh"];
		var buf = new StringBuffer();
		for ( var idx in dText ) {
			buf.append('<div class="betslipRow">');
			buf.append('<div class="disclaimerCellLeft">').append(idx).append('</div>');
			buf.append('<div class="disclaimerCellRight">').append(dText[idx]).append('</div>');
			buf.append('</div>');
		}
		$('#disclaimerText').html(buf.toString());
	}).fail(function() {console.log(arguments)});
}